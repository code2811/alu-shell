#!/usr/bin/env bash
# Script to parse Apache log, group by IP and HTTP code, and sort by occurrences

# Check if the log file exists and is not empty
LOG_FILE="access.log"
if [ ! -f "$LOG_FILE" ] || [ ! -s "$LOG_FILE" ]; then
    exit 0
fi

# Use awk to extract IP ($1) and HTTP code ($9), group by both, count occurrences, and sort the output
awk '{ if ($9 ~ /^[0-9]{3}$/) print $1, $9 }' "$LOG_FILE" | \
awk '{counts[$0]++} END {for (item in counts) print counts[item], item}' | \
sort -nr


